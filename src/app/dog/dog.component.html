<div class="min-h-screen w-full">

   <div
      class="min-h-screen bg-gray-50 dark:bg-slate-950 text-gray-900 dark:text-slate-200 font-sans transition-colors duration-300 flex flex-col">

      <!-- Main Content Area -->
      <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 flex-1 overflow-y-auto">

         <!-- Sub-header for Smart Collar Context -->
         <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
            <div>
               <h2 class="text-2xl font-bold text-gray-900 dark:text-white" i18n="dogActiveMonitor">Active Monitor</h2>
               <div class="flex items-center gap-2 mt-1">
                  <span
                     class="inline-flex items-center rounded-md bg-blue-50 dark:bg-blue-900/30 px-2 py-1 text-xs font-medium text-blue-700 dark:text-blue-300 ring-1 ring-inset ring-blue-700/10">Unit:
                     K9-XJ9</span>
                  <span i18n="dogLiveSignal"
                     class="inline-flex items-center gap-1.5 rounded-md bg-emerald-50 dark:bg-emerald-900/30 px-2 py-1 text-xs font-medium text-emerald-700 dark:text-emerald-300 ring-1 ring-inset ring-emerald-600/20">
                     <span class="w-1.5 h-1.5 rounded-full bg-emerald-500 animate-pulse"></span>
                     Live Signal
                  </span>
               </div>
            </div>

            <!-- Stats Bar -->
            <div class="flex gap-4 overflow-x-auto pb-2 md:pb-0">
               <!-- Battery -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 px-4 py-2 flex items-center gap-3">
                  <div class="flex flex-col items-end">
                     <span
                        class="text-[10px] uppercase text-gray-500 dark:text-gray-400 font-bold tracking-wider" i18n="dogBattery">Battery</span>
                     <span class="text-sm font-bold" [class.text-red-500]="status().battery < 20">{{status().battery |
                        number:'1.2-2'}}%</span>
                  </div>
                  <div class="w-8 h-4 border border-gray-400 dark:border-gray-500 rounded-[2px] p-[2px] relative">
                     <div class="h-full bg-emerald-500 rounded-[1px] transition-all duration-500"
                        [style.width.%]="status().battery" [class.bg-red-500]="status().battery < 20"></div>
                     <div class="absolute -right-1 top-1 w-0.5 h-2 bg-gray-400 dark:bg-gray-500 rounded-r-sm"></div>
                  </div>
               </div>
            </div>
         </div>

         <!-- Dashboard Grid -->
         <div class="grid grid-cols-12 gap-6">

            <!-- Left Column: Biometrics -->
            <div class="col-span-12 lg:col-span-3 flex flex-col gap-6">

               <!-- Heart Rate Card -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 relative overflow-hidden group transition-colors duration-300">
                  <div class="flex justify-between items-start mb-4 relative z-10">
                     <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium flex items-center gap-2" i18n="dogHeartRate">
                        HEART RATE
                        <span class="w-2 h-2 rounded-full bg-rose-500 animate-pulse"></span>
                     </h3>
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-rose-500">
                        <path
                           d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z" />
                     </svg>
                  </div>

                  <div class="flex items-baseline gap-2 relative z-10">
                     <span
                        class="text-5xl font-bold text-gray-900 dark:text-white tracking-tighter">{{status().heartRate}}</span>
                     <span class="text-sm text-gray-500 dark:text-gray-400 font-medium">BPM</span>
                  </div>

                  <!-- Graph -->
                  <div class="h-16 mt-4 w-full relative overflow-hidden">
                     <svg class="w-full h-full" preserveAspectRatio="none">
                        <path [attr.d]="heartPath()" fill="none" stroke="#f43f5e" stroke-width="2"
                           class="drop-shadow-sm"></path>
                     </svg>
                  </div>
               </div>

               <!-- Anxiety Level -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 relative overflow-hidden transition-colors duration-300">
                  <div class="flex justify-between items-start mb-6">
                     <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium" i18n="dogAnxiety">ANXIETY INDEX</h3>
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-violet-500">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M12 6v6l4 2" />
                     </svg>
                  </div>

                  <div class="relative w-40 h-40 mx-auto">
                     <!-- Gauge Background -->
                     <svg class="w-full h-full transform -rotate-90">
                        <circle cx="80" cy="80" r="70" fill="none" class="stroke-gray-100 dark:stroke-gray-700"
                           stroke-width="12" stroke-dasharray="440" stroke-dashoffset="110" stroke-linecap="round" />
                        <circle cx="80" cy="80" r="70" fill="none" [attr.stroke]="getAnxietyColor()" stroke-width="12"
                           stroke-dasharray="440" [attr.stroke-dashoffset]="anxietyOffset()" stroke-linecap="round"
                           class="transition-all duration-700 ease-out" />
                     </svg>
                     <div class="absolute inset-0 flex flex-col items-center justify-center">
                        <span class="text-3xl font-bold text-gray-900 dark:text-white">{{status().anxietyLevel}}</span>
                        <span
                           class="text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold" i18n="dogAnxietyLabel">{{getAnxietyLabel()}}</span>
                     </div>
                  </div>

                  <div class="mt-4 grid grid-cols-3 gap-2 text-center text-xs text-gray-600 dark:text-gray-400">
                     <div class="py-1 rounded bg-gray-50 dark:bg-gray-700/50 transition-colors"
                        [class.bg-emerald-50]="status().anxietyLevel < 30"
                        [class.text-emerald-600]="status().anxietyLevel < 30" i18n="dogAnxietyCalm">Calm</div>
                     <div class="py-1 rounded bg-gray-50 dark:bg-gray-700/50 transition-colors"
                        [class.bg-amber-50]="status().anxietyLevel >= 30 && status().anxietyLevel < 70"
                        [class.text-amber-600]="status().anxietyLevel >= 30 && status().anxietyLevel < 70" i18n="dogAnxietyAlert">Alert</div>
                     <div class="py-1 rounded bg-gray-50 dark:bg-gray-700/50 transition-colors"
                        [class.bg-red-50]="status().anxietyLevel >= 70"
                        [class.text-red-600]="status().anxietyLevel >= 70" i18n="dogAnxietyStress">Stress</div>
                  </div>
               </div>

               <!-- Sound Sensor -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 flex-1 min-h-[160px] flex flex-col transition-colors duration-300">
                  <div class="flex justify-between items-center mb-4">
                     <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium flex items-center gap-2" i18n="dogSoundSensor">
                        SOUND SENSOR
                        @if(status().isBarking) {
                        <span
                           class="px-1.5 py-0.5 rounded text-[10px] font-bold bg-orange-100 text-orange-600 dark:bg-orange-500/20 dark:text-orange-400 animate-pulse border border-orange-200 dark:border-orange-500/30">BARKING</span>
                        }
                     </h3>
                     <span class="text-xs font-mono text-cyan-600 dark:text-cyan-400">{{status().decibels}} dB</span>
                  </div>

                  <!-- Visualizer -->
                  <div class="flex-1 flex items-end justify-center gap-1 h-24 overflow-hidden relative">
                     <div *ngFor="let bar of soundBars(); let i = index"
                        class="w-1.5 bg-cyan-500 rounded-t-sm transition-all duration-75 ease-linear"
                        [style.height.%]="bar" [style.opacity]="(i > 8 && i < 24) ? 1 : 0.4"
                        [class.bg-orange-500]="status().isBarking">
                     </div>
                     <!-- dB Threshold Line -->
                     <div class="absolute top-1/3 w-full border-t border-dashed border-gray-300 dark:border-gray-600">
                     </div>
                  </div>
               </div>

            </div>

            <!-- Center Column: Map -->
            <div class="col-span-12 lg:col-span-6 flex flex-col gap-6 h-[350px] lg:h-auto">
               <div
                  class="h-full bg-slate-100 dark:bg-slate-900 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden relative group transition-colors duration-300">

                  <!-- Map Controls Overlay -->
                  <div class="absolute top-4 left-4 z-20 flex flex-col gap-2">
                     <div
                        class="bg-white/90 dark:bg-slate-900/90 backdrop-blur border border-gray-200 dark:border-slate-700 p-2 rounded-lg shadow-lg">
                        <div
                           class="text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wider font-bold mb-1" i18n="dogCurrentLocation">
                           Location</div>
                        <div class="text-sm font-mono text-cyan-600 dark:text-cyan-400">38.2466° N, 21.7346° E</div>
                     </div>
                  </div>

                  <div class="absolute top-4 right-4 z-20 flex gap-2">
                     <button
                        class="bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 p-2 rounded-lg border border-gray-200 dark:border-slate-700 transition shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <circle cx="12" cy="12" r="10" />
                           <line x1="22" x2="18" y1="12" y2="12" />
                           <line x1="6" x2="2" y1="12" y2="12" />
                           <line x1="12" x2="12" y1="6" y2="2" />
                           <line x1="12" x2="12" y1="22" y2="18" />
                        </svg>
                     </button>
                     <button
                        class="bg-white dark:bg-slate-800 hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 p-2 rounded-lg border border-gray-200 dark:border-slate-700 transition shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                           stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                           <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0Z" />
                           <circle cx="12" cy="10" r="3" />
                        </svg>
                     </button>
                  </div>

                  <!-- Simulated Map (SVG) -->
                  <div
                     class="absolute inset-0 bg-emerald-50/50 dark:bg-[#0f172a] pattern-grid-lg transition-colors duration-500">
                     <!-- Map Grid lines -->
                     <svg width="100%" height="100%"
                        class="absolute inset-0 pointer-events-none opacity-20 dark:opacity-20 text-gray-400 dark:text-slate-500">
                        <defs>
                           <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                              <path d="M 40 0 L 0 0 0 40" fill="none" stroke="currentColor" stroke-width="0.5" />
                           </pattern>
                        </defs>
                        <rect width="100%" height="100%" fill="url(#grid)" />
                     </svg>

                     <!-- Park/Terrain Shapes (Abstract) -->
                     <div class="absolute inset-0 opacity-10 dark:opacity-10">
                        <svg viewBox="0 0 100 100" preserveAspectRatio="none"
                           class="w-full h-full text-emerald-600 dark:text-emerald-500 fill-current">
                           <path d="M0,0 H100 V100 H0 Z" fill="none" />
                           <path d="M10,10 Q40,5 60,30 T90,80 L100,100 H0 Z" />
                           <path d="M70,0 Q60,40 20,60 L0,50 V0 Z" class="text-gray-400 dark:text-slate-500" />
                        </svg>
                     </div>

                     <!-- Safe Zone Circle -->
                     <div
                        class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[300px] h-[300px] rounded-full border border-emerald-500/30 bg-emerald-500/10 dark:bg-emerald-500/5">
                     </div>

                     <!-- Dog Marker -->
                     <div class="absolute transition-all duration-1000 ease-in-out" [style.left.%]="dogPosition().x"
                        [style.top.%]="dogPosition().y">

                        <!-- Pulse Effect -->
                        <div class="absolute -left-3 -top-3 w-6 h-6 bg-cyan-500/30 rounded-full animate-ping"></div>

                        <!-- Icon -->
                        <div
                           class="relative z-10 w-8 h-8 -ml-4 -mt-4 bg-white dark:bg-slate-900 border-2 border-cyan-500 rounded-full flex items-center justify-center shadow-lg shadow-cyan-500/30">
                           <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"
                              fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                              stroke-linejoin="round" class="text-cyan-600 dark:text-cyan-400">
                              <path
                                 d="M10 5.172C10 3.782 8.423 2.679 6.5 3c-2.823.47-4.113 6.006-4 7 .08.703 1.725 1.722 3.656 1 1.261-.472 1.963-1.454 2.344-2.5" />
                              <path
                                 d="M14.267 5.172c0-1.39 1.577-2.493 3.5-2.172 2.823.47 4.113 6.006 4 7-.08.703-1.725 1.722-3.656 1-1.261-.472-1.963-1.454-2.344-2.5" />
                              <path d="M8 14v.5" />
                              <path d="M16 14v.5" />
                              <path d="M11.25 16.25h1.5L12 17l-.75-.75Z" />
                           </svg>
                        </div>

                        <!-- Tooltip -->
                        <div
                           class="absolute top-6 left-1/2 -translate-x-1/2 bg-white dark:bg-slate-900/90 text-gray-700 dark:text-slate-200 text-[10px] px-2 py-1 rounded shadow-sm border border-gray-200 dark:border-slate-700 whitespace-nowrap z-20 pointer-events-none"
                           i18n="dogLocationTracking">
                           Tracking Active
                        </div>
                     </div>

                  </div>
               </div>
            </div>

            <!-- Right Column: Controls & Log -->
            <div class="col-span-12 lg:col-span-3 flex flex-col gap-6">

               <div class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-gray-700 p-5 transition-colors duration-300">
                  <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium mb-4" i18n="dogTemperature">TEMPERATURE</h3>
                  <div class="space-y-4 gap-2 flex items-baseline">
                     <span
                        class="text-5xl font-bold text-gray-900 dark:text-white tracking-tighter">{{status().temperature}}</span>
                        <span class="text-sm text-gray-500 dark:text-gray-400 font-medium">°C</span>
                  </div>
               </div>

               <!-- Deterrent Controls -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 transition-colors duration-300">
                  <div class="flex items-center gap-2 mb-6">
                     <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-amber-500">
                        <path d="M12 2v8" />
                        <path d="m4.93 10.93 1.41 1.41" />
                        <path d="M2 18h2" />
                        <path d="M20 18h2" />
                        <path d="m19.07 10.93-1.41 1.41" />
                        <path d="M22 22H2" />
                        <path d="m16 6-4 4-4-4" />
                        <path d="M16 18a4 4 0 0 0-8 0" />
                     </svg>
                     <h3 class="text-gray-500 dark:text-gray-400 text-sm font-medium" i18n="dogDeterrentControls">DETERRENT CONTROLS</h3>
                  </div>

                  <div class="space-y-4">
                     <!-- Vibration Control -->
                     <div class="group relative">
                        <button (click)="triggerDeterrent('vibration')" [disabled]="controls().vibrationActive"
                           class="w-full relative overflow-hidden bg-gray-50 dark:bg-slate-700 hover:bg-gray-100 dark:hover:bg-slate-600 border border-gray-200 dark:border-slate-600 text-gray-700 dark:text-slate-200 p-4 rounded-xl flex items-center justify-between transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed">

                           <div class="flex items-center gap-4 z-10">
                              <div
                                 class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-500/20 flex items-center justify-center text-blue-600 dark:text-blue-400">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" [class.animate-vibrate]="controls().vibrationActive">
                                    <path d="M2 12c.5-5 4-9 10-9s9.5 4 10 9" />
                                    <path d="M7 13v-3h10v3" />
                                    <path d="M9 9h.01" />
                                    <path d="M15 9h.01" />
                                    <path d="M12 22c-3.5 0-6-4-6-9" />
                                    <path d="M18 13c0 5-2.5 9-6 9" />
                                 </svg>
                              </div>
                              <div class="text-left">
                                 <div class="font-bold" i18n="dogHapticVibration">Haptic Vibration</div>
                                 <div class="text-xs text-gray-500 dark:text-gray-400" i18n="dogLowIntensityCorrection">Low intensity correction</div>
                              </div>
                           </div>

                           <!-- Progress Bar Background -->
                           @if(controls().vibrationActive) {
                           <div class="absolute inset-0 bg-blue-100 dark:bg-blue-600/20 z-0">
                              <div class="h-full bg-blue-200 dark:bg-blue-600/20 animate-progress origin-left"></div>
                           </div>
                           }

                        </button>
                     </div>

                     <!-- Ultrasonic Control -->
                     <div class="group relative">
                        <button (click)="triggerDeterrent('ultrasonic')" [disabled]="controls().ultrasonicActive"
                           class="w-full relative overflow-hidden bg-gray-50 dark:bg-slate-700 hover:bg-gray-100 dark:hover:bg-slate-600 border border-gray-200 dark:border-slate-600 text-gray-700 dark:text-slate-200 p-4 rounded-xl flex items-center justify-between transition-all active:scale-[0.98] disabled:opacity-70 disabled:cursor-not-allowed">

                           <div class="flex items-center gap-4 z-10">
                              <div
                                 class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-500/20 flex items-center justify-center text-amber-600 dark:text-amber-400">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round" [class.animate-pulse]="controls().ultrasonicActive">
                                    <path d="M2 10v3" />
                                    <path d="M6 6v11" />
                                    <path d="M10 3v18" />
                                    <path d="M14 8v7" />
                                    <path d="M18 5v13" />
                                    <path d="M22 10v3" />
                                 </svg>
                              </div>
                              <div class="text-left">
                                 <div class="font-bold" i18n="dogUltrasonicPulse">Ultrasonic Pulse</div>
                                 <div class="text-xs text-gray-500 dark:text-gray-400" i18n="dogHighFrequencySound">High frequency sound</div>
                              </div>
                           </div>

                           <!-- Progress Bar Background -->
                           @if(controls().ultrasonicActive) {
                           <div class="absolute inset-0 bg-amber-100 dark:bg-amber-600/20 z-0">
                              <div class="h-full bg-amber-200 dark:bg-amber-600/20 animate-progress origin-left"></div>
                           </div>
                           }

                        </button>
                     </div>
                  </div>
               </div>

               <!-- Activity Log -->
               <div
                  class="bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-200 dark:border-gray-700 p-5 h-[300px] flex flex-col overflow-hidden transition-colors duration-300">
                  <h3
                     class="text-gray-500 dark:text-gray-400 text-sm font-medium mb-4 flex items-center justify-between" i18n="dogSystemLog">
                     SYSTEM LOG
                     <span
                        class="text-[10px] bg-gray-100 dark:bg-gray-700 px-2 py-0.5 rounded border border-gray-200 dark:border-gray-600">REAL-TIME</span>
                  </h3>

                  <div
                     class="flex-1 overflow-y-auto space-y-3 pr-2 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700 scrollbar-track-transparent">
                     <div *ngFor="let log of logs()" class="flex gap-3 text-xs animate-fade-in group">
                        <div class="w-12 text-gray-400 dark:text-slate-500 font-mono shrink-0">{{log.time}}</div>
                        <div class="flex-1">
                           <span [ngClass]="{
                              'text-emerald-600 dark:text-emerald-400': log.type === 'info',
                              'text-amber-600 dark:text-amber-400': log.type === 'action',
                              'text-rose-600 dark:text-rose-400': log.type === 'alert'
                           }" class="font-bold mr-1">
                              [{{log.type | uppercase}}]
                           </span>
                           <span class="text-gray-700 dark:text-slate-300">{{log.message}}</span>
                        </div>
                     </div>
                  </div>
               </div>

            </div>
         </div>
      </main>
   </div>

   <!-- Connection Status Toast -->
   <div class="absolute bottom-6 left-6 z-50" i18n="dogConnectionStatus">
      @if(controls().feedbackMessage) {
      <div
         class="bg-gray-900 dark:bg-slate-800 text-white px-4 py-3 rounded-lg shadow-2xl border border-gray-700 dark:border-slate-700 flex items-center gap-3 animate-slide-up">
         <div class="w-2 h-2 rounded-full bg-cyan-400 animate-pulse"></div>
         {{controls().feedbackMessage}}
      </div>
      }

   </div>

</div>